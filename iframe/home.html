<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN” “http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>新乡流量监控平台</title>
    <link rel="stylesheet" href="../css/layui.css">
    <link rel="stylesheet" href="../css/modules/laydate/default/laydate.css">
    <link rel="stylesheet" href="../css/modules/layer/default/layer.css">
    <link rel="stylesheet" href="../css/reset.css">
    <style>
        html {
            height: auto;
            background: #f4f4f4;
            overflow-y: scroll;
        }

        .home {
            /* height: calc(100% - 80px); */
            margin: 20px;
            display: flex;
            box-sizing: border-box;
        }

        .homeL {
            width: 75%;
            height: 100%;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .homeL_t {
            height: 390px;
            border-radius: 10px;
        }

        .homeL_c {
            margin-top: 20px;
            height: 470px;
            /* background: azure; */
            border-radius: 10px;
        }

        .zdy {
            position: absolute;
            left: 140px;
            top: 9px;
        }

        .yjzs {
            position: absolute;
            right: 25px;
            top: 9px;
        }

        .yjzs .layui-form-label {
            padding: 4px 0px;
        }

        .yjzs .layui-form-select .layui-input {
            margin-left: -20px;
        }

        .layui-form-item {
            margin: 0;
            font-size: 16px;
        }

        .layui-input,
        .layui-select,
        .layui-textarea {
            height: 26px;
            line-height: 26px;
            font-size: 16px;
            width: 120px;
        }

        .layui-form-select dl dd.layui-this {
            font-size: 16px;
        }

        .layui-form-select dl dd,
        .layui-form-select dl dt {
            line-height: 26px;
        }

        .layui-select-tips {
            font-size: 16px;
        }

        .layui-form-select .layui-edge {
            border-top-color: #49A7F8;
        }

        .jzsj {
            position: absolute;
            right: 30px;
            top: 0;
            font-size: 18px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: rgba(101, 101, 101, 1);
        }

        .homeL_b {
            margin-top: 20px;
            height: 490px;
        }

        .homeR {
            width: 25%;
            margin-left: 20px;
            overflow-y: hidden;
            height: 1000px;
            position: relative;
            border-radius: 10px;
        }

        .layui-card {
            margin-bottom: 0;
        }

        .tip {
            width: 4px;
            height: 20px;
            background: rgba(76, 162, 254, 1);
            border-radius: 2px;
            display: inline-block;
            position: absolute;
            top: 12px;
            left: 6px;
        }

        .layui-card-header {
            border-bottom: 1px solid rgba(221, 221, 221, 1);
            font-size: 20px !important;
            font-family: Microsoft YaHei !important;
            font-weight: 400 !important;
            color: rgba(51, 51, 51, 1) !important;
            padding: 0 18px;
        }

        .homeL .layui-card-body {
            display: flex;
            position: relative;
            padding: 10px 30px;
            justify-content: space-between;
        }

        .layui-card-body .it {
            width: 250px;

            background: rgba(255, 255, 255, 1);
            border: 1px solid rgba(221, 221, 221, 1);
            border-radius: 6px;
        }

        .it .itemT {
            color: rgba(51, 51, 51, 1);
            font-size: 16px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            text-align: center;
            height: 30px;
            line-height: 30px;
            background: #DDDDDD;
        }


        .ms {
            height: 50px;
            margin-bottom: 10px;
            /* background: antiquewhite; */
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }

        .ms .ms_tip {
            display: flex;
            align-items: center;

            margin: 0 auto;
        }

        .ms .ydbs {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgba(76, 162, 254, 1);
            border-radius: 50%;
            margin-right: 5px;
        }

        .ms .ydbs2 {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgba(128, 128, 128, 1);
            border-radius: 50%;
            margin-right: 5px;

        }

        .ms .yjtip {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgba(212, 48, 48, 1);
            border-radius: 50%;
            margin-right: 5px;
        }

        .ms .fmtip {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgba(255, 141, 26, 1);
            border-radius: 50%;
            margin-right: 5px;
        }

        .qymc {
            /* width: 230px; */
            background: rgba(255, 255, 255, 1);
            border: 1px solid rgba(221, 221, 221, 1);
            border-radius: 6px;
            height: 215px;
        }

        .qymc .tipName {
            height: 40px;
            background: linear-gradient(90deg, rgba(13, 143, 255, 1) 0%, rgba(134, 198, 255, 1) 100%);
            line-height: 40px;
        }

        .tipName img {
            width: 24px;
            /* margin-left: 10px; */
            position: absolute;
            left: 30px;
            top: 20px;
        }

        .tipName span {
            font-size: 16px;
            font-family: Microsoft YaHei;
            font-weight: bold;
            color: rgba(255, 255, 255, 1);
            position: absolute;
            top: 12.5px;
            left: 58px;
        }

        .tipon p {
            font-size: 16px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: rgba(101, 101, 101, 1);
            padding-left: 15px;
            height: 28px;
            line-height: 30px;
        }

        .tipon .num {
            color: #FF8D19;
        }

        .tipbottom {
            height: 37px;
            position: relative;
            border-top: 1px solid rgb(221, 221, 221);
            font-size: 12px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: rgba(153, 153, 153, 1);
        }

        .tipbottom p {
            position: absolute;
            bottom: 5px;
            right: 10px;
        }

        #d {
            overflow: hidden;
        }

        .sx {
            width: 26px;
            position: absolute;
            right: 10px;
            top: 7px;
            cursor: pointer;
        }

        .box {

            margin: 100px auto;

            width: 50px;

            height: 60px;


            position: absolute;
            z-index: 999;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);


        }

        .box>div {

            background-color: rgb(20, 146, 255);

            height: 100%;

            width: 6px;

            display: inline-block;

            -webkit-animation: stretchdelay 1.2s infinite ease-in-out;

            animation: stretchdelay 1.2s infinite ease-in-out;

        }

        .box .r2 {

            -webkit-animation-delay: -1.1s;

            animation-delay: -1.1s;

        }

        .box .r3 {

            -webkit-animation-delay: -1.0s;

            animation-delay: -1.0s;

        }

        .box .r4 {

            -webkit-animation-delay: -0.9s;

            animation-delay: -0.9s;

        }

        .box .r5 {

            -webkit-animation-delay: -0.8s;

            animation-delay: -0.8s;

        }

        @-webkit-keyframes stretchdelay {

            0%,

            40%,

            100% {

                -webkit-transform: scaleY(0.4)
            }

            20% {

                -webkit-transform: scaleY(1.0)
            }

        }

        @keyframes stretchdelay {

            0%,

            40%,

            100% {

                transform: scaleY(0.4);

                -webkit-transform: scaleY(0.4);

            }

            20% {

                transform: scaleY(1.0);

                -webkit-transform: scaleY(1.0);

            }

        }

        @media screen and (max-width:1300px) {
            .homeL_t {
                height: 290px;
            }

            .layui-card-body .it {
                width: 180px;
            }

            .ms {
                height: 50px;
            }

            .canv {
                width: 180px;
                height: 130px;
            }

            /* .ms .ms_tip {
                margin-left: 50px;
            } */

            .homeL_c {
                height: 360px;
            }

            .homeL_b {
                height: 360px;
            }

            .cav {
                width: 1200px;
                height: 300px;
            }

            .layui-card-header {

                font-size: 14px !important;

            }

            .sx {
                width: 18px;
                position: absolute;
                right: 10px;
                top: 10px;
                cursor: pointer;
            }

            .jzsj {
                font-size: 14px;
            }

            .homeR {
                height: 1050px;
            }
        }

        @media screen and (min-width:1301px)and (max-width:1400px) {
            .homeL_t {
                height: 300px;
            }

            .layui-card-body .it {
                width: 200px;
            }

            .ms {
                height: 50px;
            }

            .canv {
                width: 200px;
                height: 140px;
            }

            /* .ms .ms_tip {
                margin-left: 50px;
            } */

            .homeL_c {
                height: 380px;
            }

            .homeL_b {
                height: 380px;
            }

            .cav {
                width: 1200px;
                height: 320px;
            }

            .homeR {
                height: 1100px;
            }
        }

        @media screen and (min-width:1500px) {
            .homeL_t {
                height: 310px;
            }

            .layui-card-body .it {
                width: 180px;
            }

            .ms {
                height: 50px;
            }

            .canv {
                width: 180px;
                height: 140px;
            }

            /* .ms .ms_tip {
                margin-left: 60px;
            } */

            .homeL_c {
                height: 400px;
            }

            .homeL_b {
                height: 400px;
            }

            .cav {
                width: 1200px;
                height: 340px;
            }
        }

        @media screen and (min-width:1600px) {
            .homeL_t {
                height: 340px;
            }

            .layui-card-body .it {
                width: 250px;
            }

            .ms {
                height: 50px;
            }

            .canv {
                width: 250px;
                height: 180px;
            }

            /* .ms .ms_tip {
                margin-left: 60px;
            } */

            .homeL_c {
                height: 470px;
            }

            .homeL_b {
                height: 470px;
            }

            .cav {
                width: 1200px;
                height: 420px;
            }

            .homeR {
                height: 1320px;
            }
        }


        @media screen and (min-width:1700px) {
            .homeL_t {
                height: 330px;
            }

            .layui-card-body .it {
                width: 200px;
            }

            .ms {
                height: 50px;
            }

            .canv {
                width: 200px;
                height: 160px;
            }

            /* .ms .ms_tip {
                margin-left: 60px;
            } */

            .homeL_c {
                height: 440px;
            }

            .homeL_b {
                height: 440px;
            }

            .cav {
                width: 1200px;
                height: 380px;
            }
        }

        #ui,
        #fmDetail {
            height: 100%;
        }

        #fmDetail .ydbs {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #5FB878;
            border-radius: 50%;
            vertical-align: text-bottom;
            margin-left: 5px;
        }

        #fmDetail .ydbs2 {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgba(128, 128, 128, 1);
            border-radius: 50%;
            vertical-align: text-bottom;
            margin-left: 5px;

        }

        #ui .name {
            display: inline-block;
            width: 250px;
        }

        #fmDetail .name {
            display: inline-block;
            width: 250px;
        }

        #ui ul {
            width: 90%;
            height: 90%;
            border: 1px solid #C3C3C3;
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px;
        }

        #fmDetail ul {
            width: 90%;
            height: 90%;
            border: 1px solid #C3C3C3;
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px;
        }

        #ui li p {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 31px;
            line-height: 31px;
        }

        #fmDetail li p {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 31px;
            line-height: 31px;
        }

        #ui li p .tz {
            font-size: 14px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: rgba(102, 102, 102, 1);
        }

        #fmDetail li p .tz {
            font-size: 14px;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: rgba(102, 102, 102, 1);
        }

        .tz:hover {
            color: #1492ff !important;
        }
    </style>
</head>

<div class="container">

    <div class="layui-row lrow">
        <span class="layui-breadcrumb" lay-separator=":">
            <a href="javascript:;">当前位置</a>
            <a href="../index.html" target="_top">首页</a>

        </span>
    </div>
    <div class="padd"></div>

    <div class="home">

        <div class="homeL">
            <div class="homeL_t layui-card">

                <div class="layui-card-header">
                    <span class="tip"></span>
                    实时统计</div>
                <div class="layui-card-body">
                    <div class="zxtj it">
                        <div class="itemT">企业在线统计</div>
                        <div class="itemC">
                            <div class="canv" id="canvas_zxtj"></div>
                            <div class="ms">
                                <div style="display: flex;justify-content: space-around;">
                                    <div class="ms_tip">
                                        <span class="ydbs"></span>
                                        <span>在线：
                                            <span id="qy_online"></span>
                                        </span>
                                    </div>
                                    <div class="ms_tip">
                                        <span class="ydbs2"></span>
                                        <span>离线：
                                            <span id="qy_unline"></span>
                                        </span>
                                    </div>
                                </div>
                                <p style="text-align: center;color: #1492ff;cursor: pointer;" id="qyline">点击查看详情</p>
                            </div>
                        </div>
                    </div>
                    <div class="pfyj it">
                        <div class="itemT">排放预警企业统计</div>
                        <div class="itemC">
                            <div class="canv" id="canvas_pfyj"></div>
                            <div class="ms">
                                <div style="display: flex;justify-content: space-around;">
                                    <div class="ms_tip">
                                        <span class="ydbs"></span>
                                        <p>正常：30</p>
                                    </div>
                                    <div class="ms_tip">
                                        <span class="yjtip"></span>
                                        <p>异常：80</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sxt it">
                        <div class="itemT">摄像头在线统计</div>
                        <div class="itemC">
                            <div class="canv" id="canvas_sxt"></div>
                            <div class="ms">
                                <div style="display: flex;justify-content: space-around;">
                                    <div class="ms_tip">
                                        <span class="ydbs"></span>
                                        <p>在线：
                                            <span id="sxt_online"></span>
                                        </p>
                                    </div>
                                    <div class="ms_tip">
                                        <span class="ydbs2"></span>
                                        <p>离线：
                                            <span id="sxt_unline"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="fm it">
                        <div class="itemT">阀门状态统计</div>
                        <div class="itemC">
                            <div class="canv" id="canvas_fm"></div>
                            <div class="ms">
                                <div style="display: flex;justify-content: space-around;">
                                    <div class="ms_tip">
                                        <span class="ydbs"></span>
                                        <p>开启：
                                            <span id="fm_open"></span>
                                        </p>
                                    </div>
                                    <div class="ms_tip">
                                        <span class="fmtip"></span>
                                        <p>关闭：
                                            <span id="fm_close"></span>
                                        </p>
                                    </div>
                                </div>
                                <p style="text-align: center;color: #1492ff;cursor: pointer;" id="xqfm">点击查看详情</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="homeL_c layui-card">
                <div class="layui-card-header">
                    <span class="tip"></span>
                    实时排放统计(单位:吨)
                    <form class="layui-form zdy" lay-filter="example">
                        <div class="layui-form-item">

                            <div class="layui-input-block">

                                <select name="mcodes" lay-filter="nowpf" id="nowpf">

                                    <option value="0" selected>日排量</option>
                                    <option value="1">月排量</option>
                                </select>
                            </div>
                        </div>
                    </form>
                    <p class="jzsj">截止时间:
                        <span id="jzrq"></span>
                    </p>
                </div>
                <div class="layui-card-body">
                    <div class="cav" id="canvas_pf"></div>
                </div>
            </div>
            <div class="homeL_b layui-card">
                <div class="layui-card-header">
                    <span class="tip"></span>
                    企业排放预警次数走势(单位:次)
                    <form class="layui-form yjzs" lay-filter="example">
                        <div class="layui-form-item">
                            <label class="layui-form-label">企业:</label>
                            <div class="layui-input-block">

                                <select name="mcodes" lay-filter="qy" id="qylist">
                                    <option value="" selected>请选择</option>
                                    <option value="010">日排量</option>
                                    <option value="0571" selected>全部</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">时间:</label>
                            <div class="layui-input-block">

                                <select name="mcodes" lay-filter="qy" id="qylist">
                                    <option value="" selected>请选择</option>

                                    <option value="1" selected>2020年</option>
                                    <option value="2" selected>2019年</option>
                                    <option value="3" selected>2018年</option>
                                    <option value="4" selected>2017年</option>
                                    <option value="5" selected>2016年</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="layui-card-body">
                    <div class="cav" id="canvas_yj"></div>
                </div>
            </div>
        </div>
        <div class="homeR layui-card">
            <div class="layui-card-header">
                <span class="tip"></span>
                企业实时预警信息：
                <span style="color:#FF8D1A" id="zx">
                </span><span id="zs"></span>
                <img class="sx" src="../images/img/sx.png" alt="" title="点击刷新">

            </div>
            <div id="d">
                <div id="lod">

                    <div class="r1"></div>

                    <div class="r2"></div>

                    <div class="r3"></div>

                    <div class="r4"></div>

                    <div class="r5"></div>

                </div>
                <ul class="roll__list" style="position: relative; top: 0;">

                </ul>
            </div>

        </div>
    </div>
</div>
<!--企业在线统计详情弹窗-->
<div id="ui" style="display: none;">
    <ul id="uil">

    </ul>

</div>
<!--阀门状态统计详情弹窗-->
<div id="fmDetail" style="display: none;">
    <ul id="fmList">

    </ul>

</div>
<script src="../js/ztree/jquery.min.js"></script>
<script src="../js/rollSlide.js"></script>
<script src="../js/layui.js"></script>
<script src="../js/echarts.min.js"></script>
<script>
    //JavaScript代码区域
    var obj = {
        'L0373032600004': 'L0373032600004',
        'L0373032600005': 'L0373032600005',
        'L0373032600006': 'L0373032600006',
        'L0373032600007': 'L0373032600007',
        'L0373032600008': 'L0373032600008',
        'L0373032600009': 'L0373032600009',
        'L0373032600011': 'L0373032600011',
        'L0373032600012': 'L0373032600012',
        'L0373032600013': 'L0373032600013',
        'L0373032600014': 'L0373032600014',
        'L0373032600015': 'L0373032600015',
        'L0373032666666': 'L0373032666666',
        'L0373032600016': 'L0373032600016',
        'L0373032600017': 'L0373032600017',
        'L0373032600018': 'L0373032600018'

    };
    function tz(mn) {
        window.parent.at(mn);
    }

    layui.use(['form', 'laydate', 'layer', 'laypage', 'element', 'table', 'layer'], function () {
        var element = layui.element;
        var router = layui.router();
        var layer = layui.layer
        var form = layui.form
        var city = obj.city ? obj.city : ''
        var province = obj.province ? obj.province : ''

        // layui.$.ajax({
        //     url: httpUrl + 'manage/erps',
        //     type: 'get',
        //     data: {
        //         deptid: localStorage.getItem('deptid'),
        //         city: router.search.city,
        //         province: router.search.province
        //     },
        //     dataType: 'json',
        //     success: function (data) {

        //         var model = data.data;
        //         var str = '';
        //         for (var i = 0; i < model.length; i++) {
        //             var sitename = model[i].ename;
        //             str += '<div class="layui-col-sm4 layui-col-md3 layui-col-lg2 msg_con">' +
        //                 '<a href="./city/' + (obj[model[i].mn] ? obj[model[i].mn] : "l000000") + '.html#/mn=' + model[i].mn + '/ename=' + sitename + '">' +
        //                 '<div class="cc">' +
        //                 '<p class="p1">' + model[i].ename + '</p>' +
        //                 //                            '<p class="p2">在线状态：<span style="background: url(../images/img/wifi_'+(model[i].lstate==1?'on':'of')+'.png) no-repeat center; background-size: contain;"></span></p>'+
        //                 '<p class="p2">' +
        //                 '<span class="sp1">阀门状态 <br><i>' + (model[i].valvestatus == 0 ? '关' : '开') + '</i></span>' +
        //                 ' <span>在线状态 <br><i style="background: url(../images/img/wifi_' + (model[i].lstate == 1 ? 'on' : 'of') + '.png) no-repeat center; background-size: contain;"></i></span>' +
        //                 ' </p>' +
        //                 '<p class=""><a onclick="tz(\'' + model[i].mn + '\')"  href="./city/' + (obj[model[i].mn] ? obj[model[i].mn] : "l000000") + '.html#/mn=' + model[i].mn + '/ename=' + sitename + '" target="ifrm"><span class="lk">点击查看企业实时数据>></span></a></p>' +
        //                 '</div>' +
        //                 '</a>' +
        //                 '</div>'
        //         }
        //         // layui.$('.layui-col-space5').append(str);
        //     }
        // })

        //企业在线统计
        $(function () {
            var myChart_zxtj = echarts.init(document.getElementById('canvas_zxtj'));
            var option = {

                tooltip: {

                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%)',
                    position: function (point, params, dom, rect, size) {
                        // 鼠标坐标和提示框位置的参考坐标系是：以外层div的左上角那一点为原点，x轴向右，y轴向下
                        // 提示框位置
                        var x = 0; // x坐标位置
                        var y = 0; // y坐标位置

                        // 当前鼠标位置
                        var pointX = point[0];
                        var pointY = point[1];

                        // 外层div大小
                        // var viewWidth = size.viewSize[0];
                        // var viewHeight = size.viewSize[1];

                        // 提示框大小
                        var boxWidth = size.contentSize[0];
                        var boxHeight = size.contentSize[1];

                        // boxWidth > pointX 说明鼠标左边放不下提示框
                        if (boxWidth > pointX) {
                            x = 5;
                        } else { // 左边放的下
                            x = pointX - boxWidth;
                        }

                        // boxHeight > pointY 说明鼠标上边放不下提示框
                        if (boxHeight > pointY) {
                            y = 5;
                        } else { // 上边放得下
                            y = pointY - boxHeight;
                        }

                        return [x, y];
                    }


                },

                color: ["#4CA2FE", "#808080"], //这里改变legend的颜色，同时也改变tooltip的颜色
                series: [
                    {
                        name: '在线状态',
                        type: 'pie',
                        radius: '80%',
                        avoidLabelOverlap: false,
                        // center: ['50%', '50%'],
                        data: [
                            { value: '', name: '在线' },
                            { value: '', name: '离线' },
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        label: { //去除饼图的指示折线
                            normal: {
                                show: false

                            }
                        }

                    }
                ]
            };
            layui.$.ajax({
                url: httpUrl + 'erps/StuteErps',
                type: 'get',
                data: {
                    deptid: localStorage.getItem('deptid'),
                    city: router.search.city,
                    province: router.search.province
                },
                dataType: 'json',
                beforeSend: function () {
                    myChart_zxtj.showLoading({
                        text: '',
                        textStyle: { fontSize: 30, color: '#444' },
                        color: 'rgb(20,146,255)', //加载动画颜色
                        effectOption: { backgroundColor: 'rgba(0, 0, 0, 0)' }
                    });

                },
                success: function (data) {
                    var d = data.data
                    $('#qy_online').text(d.online)
                    $('#qy_unline').text(d.noline)
                    option.series[0].data[0].value = d.online
                    option.series[0].data[1].value = d.noline
                    myChart_zxtj.setOption(option);
                },
                complete: function () {
                    myChart_zxtj.hideLoading();
                },
            })
        })

        //企业在线详情
        $('#qyline').click(function () {

            layer.open({
                title: ['企业在线统计', 'background:#1492FF;color:white;font-size:18px;font-weight:400;'],
                type: 1,
                content: $('#ui'),
                area: ['500px', '568px'], //宽高
                success: function () {

                    $('#ui').css('display', 'block');
                    layui.$.ajax({
                        url: httpUrl + 'erps/StuteErpsDetail',
                        type: 'get',
                        data: {
                            deptid: localStorage.getItem('deptid'),
                            city: router.search.city,
                            province: router.search.province
                        },
                        dataType: 'json',

                        success: function (data) {

                            var d = data.data
                            if (d && d.length > 0) {
                                var opt = ''
                                for (var n = 0; n < d.length; n++) {
                                    opt +=
                                        '<li>' +
                                        '<p>' +
                                        '<span class="name">' + d[n].ename + '</span>' +
                                        '<span style="position: relative;">' +
                                        '<span>' + d[n].onlinestat + '</span>' +
                                        '<img src=' + (d[n].onlinestat == "在线" ? "../images/img/zx.png" : "../images/img/lx.png") + ' ' + 'style="position: absolute;left: 32px;top: 7px;">' +

                                        '</span>' +
                                        '<span class="tz" atr=' + d[n].mn + ' name=' + d[n].ename + '' + ' style="cursor: pointer;">点击进入</span>' +
                                        '</p>' +
                                        '</li>'
                                }
                                $('#uil').html(opt)
                            }
                        },

                    })

                },
                cancel: function () {
                    $('#ui').css('display', 'none')
                }

            });
        })

        //排放预警统计
        $(function () {
            var myChart_pfyj = echarts.init(document.getElementById('canvas_pfyj'));
            var option = {

                tooltip: {

                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%)',
                    position: function (point, params, dom, rect, size) {
                        // 鼠标坐标和提示框位置的参考坐标系是：以外层div的左上角那一点为原点，x轴向右，y轴向下
                        // 提示框位置
                        var x = 0; // x坐标位置
                        var y = 0; // y坐标位置

                        // 当前鼠标位置
                        var pointX = point[0];
                        var pointY = point[1];

                        // 外层div大小
                        // var viewWidth = size.viewSize[0];
                        // var viewHeight = size.viewSize[1];

                        // 提示框大小
                        var boxWidth = size.contentSize[0];
                        var boxHeight = size.contentSize[1];

                        // boxWidth > pointX 说明鼠标左边放不下提示框
                        if (boxWidth > pointX) {
                            x = 5;
                        } else { // 左边放的下
                            x = pointX - boxWidth;
                        }

                        // boxHeight > pointY 说明鼠标上边放不下提示框
                        if (boxHeight > pointY) {
                            y = 5;
                        } else { // 上边放得下
                            y = pointY - boxHeight;
                        }

                        return [x, y];
                    }


                },

                color: ["#4CA2FE", "#D32F2F"], //这里改变legend的颜色，同时也改变tooltip的颜色
                series: [
                    {
                        name: '排放预警',
                        type: 'pie',
                        radius: '80%',
                        avoidLabelOverlap: false,
                        center: ['50%', '50%'],
                        data: [
                            { value: 30, name: '正常排放' },
                            { value: 80, name: '异常排放' },
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        label: { //去除饼图的指示折线
                            normal: {
                                show: false

                            }
                        }

                    }
                ]
            };
            myChart_pfyj.setOption(option);
        })
        //摄像头统计
        $(function () {
            var myChart_sxt = echarts.init(document.getElementById('canvas_sxt'));
            var option = {

                tooltip: {

                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%)',
                    position: function (point, params, dom, rect, size) {
                        // 鼠标坐标和提示框位置的参考坐标系是：以外层div的左上角那一点为原点，x轴向右，y轴向下
                        // 提示框位置
                        var x = 0; // x坐标位置
                        var y = 0; // y坐标位置

                        // 当前鼠标位置
                        var pointX = point[0];
                        var pointY = point[1];

                        // 外层div大小
                        // var viewWidth = size.viewSize[0];
                        // var viewHeight = size.viewSize[1];

                        // 提示框大小
                        var boxWidth = size.contentSize[0];
                        var boxHeight = size.contentSize[1];

                        // boxWidth > pointX 说明鼠标左边放不下提示框
                        if (boxWidth > pointX) {
                            x = 5;
                        } else { // 左边放的下
                            x = pointX - boxWidth;
                        }

                        // boxHeight > pointY 说明鼠标上边放不下提示框
                        if (boxHeight > pointY) {
                            y = 5;
                        } else { // 上边放得下
                            y = pointY - boxHeight;
                        }

                        return [x, y];
                    }


                },

                color: ["#4CA2FE", "#808080"], //这里改变legend的颜色，同时也改变tooltip的颜色
                series: [
                    {
                        name: '摄像头统计',
                        type: 'pie',
                        radius: '80%',
                        avoidLabelOverlap: false,
                        center: ['50%', '50%'],
                        data: [
                            { value: '', name: '在线' },
                            { value: '', name: '离线' }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        label: { //去除饼图的指示折线
                            normal: {
                                show: false

                            }
                        }

                    }
                ]
            };
            layui.$.ajax({
                url: httpUrl + 'cameraInfo/getCameraOnline',
                type: 'get',
                data: {
                    deptid: localStorage.getItem('deptid'),
                    city: router.search.city,
                    province: router.search.province,
                },
                dataType: 'json',
                beforeSend: function () {
                    myChart_sxt.showLoading({
                        text: '',
                        textStyle: { fontSize: 30, color: '#444' },
                        color: 'rgb(20,146,255)', //加载动画颜色
                        effectOption: { backgroundColor: 'rgba(0, 0, 0, 0)' }
                    });

                },
                success: function (data) {
                    var d = data.data
                    $('#sxt_online').text(d.online)
                    $('#sxt_unline').text(d.noline)
                    option.series[0].data[0].value = d.online
                    option.series[0].data[1].value = d.noline
                    myChart_sxt.setOption(option);

                },
                complete: function () {
                    myChart_sxt.hideLoading();
                },
            })
        })

        //阀门状态统计
        $(function () {
            var myChart_fm = echarts.init(document.getElementById('canvas_fm'));
            var option = {

                tooltip: {

                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%)',
                    position: function (point, params, dom, rect, size) {
                        // 鼠标坐标和提示框位置的参考坐标系是：以外层div的左上角那一点为原点，x轴向右，y轴向下
                        // 提示框位置
                        var x = 0; // x坐标位置
                        var y = 0; // y坐标位置

                        // 当前鼠标位置
                        var pointX = point[0];
                        var pointY = point[1];

                        // 外层div大小
                        // var viewWidth = size.viewSize[0];
                        // var viewHeight = size.viewSize[1];

                        // 提示框大小
                        var boxWidth = size.contentSize[0];
                        var boxHeight = size.contentSize[1];

                        // boxWidth > pointX 说明鼠标左边放不下提示框
                        if (boxWidth > pointX) {
                            x = 5;
                        } else { // 左边放的下
                            x = pointX - boxWidth;
                        }

                        // boxHeight > pointY 说明鼠标上边放不下提示框
                        if (boxHeight > pointY) {
                            y = 5;
                        } else { // 上边放得下
                            y = pointY - boxHeight;
                        }

                        return [x, y];
                    }


                },

                color: ["#4CA2FE", "#FF8D19"], //这里改变legend的颜色，同时也改变tooltip的颜色
                series: [
                    {
                        name: '阀门状态',
                        type: 'pie',
                        radius: '80%',
                        avoidLabelOverlap: false,
                        center: ['50%', '50%'],
                        data: [
                            { value: '', name: '开启' },
                            { value: '', name: '关闭' },
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        },
                        label: { //去除饼图的指示折线
                            normal: {
                                show: false

                            }
                        }

                    }
                ]
            };



            layui.$.ajax({
                url: httpUrl + 'erps/getvalvestatus',
                type: 'get',
                data: {
                    deptid: localStorage.getItem('deptid'),
                    city: router.search.city,
                    province: router.search.province,

                },
                dataType: 'json',
                beforeSend: function () {
                    myChart_fm.showLoading({
                        text: '',
                        textStyle: { fontSize: 30, color: '#444' },
                        color: 'rgb(20,146,255)', //加载动画颜色
                        effectOption: { backgroundColor: 'rgba(0, 0, 0, 0)' }
                    });

                },
                success: function (data) {

                    var d = data.data
                    $('#fm_open').text(d.online)
                    $('#fm_close').text(d.noline)
                    option.series[0].data[0].value = d.online
                    option.series[0].data[1].value = d.noline
                    myChart_fm.setOption(option);
                },
                complete: function () {
                    myChart_fm.hideLoading();
                },
            })

        })

        //阀门状态详情
        $('#xqfm').click(function () {

            layer.open({
                title: ['阀门状态统计', 'background:#1492FF;color:white;font-size:18px;font-weight:400;'],
                type: 1,
                content: $('#fmDetail'),
                area: ['500px', '568px'], //宽高
                success: function () {

                    $('#fmDetail').css('display', 'block');
                    layui.$.ajax({
                        url: httpUrl + 'erps/getvalvestatusDetail',
                        type: 'get',
                        data: {
                            deptid: localStorage.getItem('deptid'),
                            city: router.search.city,
                            province: router.search.province
                        },
                        dataType: 'json',

                        success: function (data) {

                            var d = data.data
                            if (d && d.length > 0) {
                                var opt = ''
                                for (var n = 0; n < d.length; n++) {
                                    opt +=
                                        '<li>' +
                                        '<p>' +
                                        '<span class="name">' + d[n].ename + '</span>' +
                                        '<span>' +
                                        '<span>' + d[n].valves + '</span>' +
                                        '<span class=' + (d[n].valves == "开启" ? "ydbs" : "ydbs2") + '></span>' +
                                        '</span>' +
                                        '<span class="tz" atr=' + d[n].mn + ' name=' + d[n].ename + '' + ' style="cursor: pointer;">点击进入</span>' +
                                        '</p>' +
                                        '</li>'
                                }
                                $('#fmList').html(opt)
                            }
                        },

                    })

                },
                cancel: function () {
                    $('#fmDetail').css('display', 'none')
                }

            });
        })
        // 实时排放统计
        pftj()
        form.on('select(nowpf)', function (data) {        //对应lay-filter
            console.log(data)
            pftj()
        })
        function pftj() {
            var myChart_pf = echarts.init(document.getElementById('canvas_pf'));
            var option = {

                grid: {
                    left: '2%',
                    right: '2%',
                    top: '4%',
                    bottom: '4%',
                    containLabel: true
                },

                tooltip: {
                    trigger: "axis", //坐标轴触发提示框
                    axisPointer: {
                        type: "shadow",
                        lineStyle: {
                            color: '#C3CBD6'
                        }
                    }

                },
                dataZoom: [

                    {
                        type: "inside",

                        start: 0,
                        end: 100
                    },

                ],
                xAxis: [{
                    type: 'category',
                    boundaryGap: true,
                    axisLine: {
                        lineStyle: {
                            color: '#999999'
                        }
                    },
                    axisLabel: {
                        interval: 0,//横轴信息全部显示
                        rotate: -45,//度角倾斜显示
                        formatter: function (value) {//只显示五个字 其余省略号
                            return value.length > 7 ? value.substring(0, 7) + '...' : value;
                        }
                    },
                    data: []
                }],
                yAxis: [{
                    type: 'value',
                    max: '',
                    min: 0,
                    splitNumber: 7,
                    axisLabel: {

                        textStyle: {
                            fontSize: 14
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#999999'
                        }
                    }
                }],
                series: [
                    {
                        name: '站点接入个数',
                        type: 'bar',
                        barWidth: 15, // 柱图宽度
                        barMaxWidth: 40, // 最大宽度
                        legendHoverLink: true,  // 是否启用图列 hover 时的联动高亮
                        itemStyle: {

                            emphasis: {
                                barBorderRadius: 30
                            },
                            normal: {
                                //柱形图圆角，初始化效果
                                color: new echarts.graphic.LinearGradient(
                                    0, 0, 0, 1,
                                    [
                                        { offset: 0, color: '#83bff6' },
                                        { offset: 0.5, color: '#188df0' },
                                        { offset: 1, color: '#188df0' }
                                    ]
                                ),
                                barBorderRadius: [10, 10, 0, 0],
                                label: {

                                    textStyle: {
                                        fontWeight: 'bolder',
                                        fontSize: '12',
                                        fontFamily: '微软雅黑',
                                    }
                                }
                            }
                        },
                        emphasis: {
                            itemStyle: {
                                color: new echarts.graphic.LinearGradient(
                                    0, 0, 0, 1,
                                    [
                                        { offset: 0, color: '#2378f7' },
                                        { offset: 0.7, color: '#2378f7' },
                                        { offset: 1, color: '#83bff6' }
                                    ]
                                )
                            }
                        },
                        // markArea: {
                        //     data: [
                        //         [{
                        //             yAxis: 0,
                        //             itemStyle: {
                        //                 color: '#fff'

                        //             }
                        //         }, {
                        //             yAxis: '20000'
                        //         }],
                        //         [{
                        //             yAxis: '20000',
                        //             itemStyle: {
                        //                 color: '#F8F8FA'

                        //             }
                        //         }, {
                        //             yAxis: '40000'
                        //         }],
                        //         [{
                        //             yAxis: '40000',
                        //             itemStyle: {
                        //                 color: '#fff'

                        //             }
                        //         }, {
                        //             yAxis: '60000'
                        //         }]
                        //     ]
                        // },

                        data: []
                    }
                ]
            };
            layui.$.ajax({
                url: httpUrl + 'erps/real_time_data',
                type: 'get',
                data: {
                    deptid: localStorage.getItem('deptid'),
                    city: router.search.city,
                    province: router.search.province,
                    type: $('#nowpf option:selected').val()
                },
                dataType: 'json',
                beforeSend: function () {
                    myChart_pf.showLoading({
                        text: '',
                        textStyle: { fontSize: 30, color: '#444' },
                        color: 'rgb(20,146,255)', //加载动画颜色
                        effectOption: { backgroundColor: 'rgba(0, 0, 0, 0)' }
                    });

                },
                success: function (data) {
                    $('#jzrq').text(data.erpsname)
                    var d = data.data
                    if (d && d.length > 0) {
                        var xData = []  //x轴企业
                        var yData = []  //y轴数据
                        for (var i = 0; i < d.length; i++) {
                            xData.push(d[i].ename)
                            yData.push(d[i].cou)
                        }
                        //循环获取最大值
                        var max = yData[0];
                        for (let k = 0; k < yData.length - 1; k++) {
                            max = max < yData[k + 1] ? yData[k + 1] : max
                        }

                        max = Math.ceil(max)
                        max = max + 10000
                        option.xAxis[0].data = xData
                        option.series[0].data = yData
                        option.yAxis[0].max = max
                        myChart_pf.setOption(option);
                    }
                },
                complete: function () {
                    myChart_pf.hideLoading();
                },
            })
        }

        //企业排放预警走势
        $(function () {
            var myChart_yj = echarts.init(document.getElementById('canvas_yj'));
            var option = {
                grid: {

                    left: '2%',
                    right: '4%',

                    containLabel: true
                },

                tooltip: {
                    trigger: "axis", //坐标轴触发提示框
                    axisPointer: {
                        lineStyle: {
                            color: '#C3CBD6'
                        }
                    }

                },
                dataZoom: [

                    //内容能不能拉
                    {
                        type: "inside",
                        realtime: true,
                        start: 0,
                        end: 100
                    }
                ],
                xAxis: [{
                    type: 'category',
                    boundaryGap: false,
                    axisLine: {
                        lineStyle: {
                            color: '#57617B'
                        }
                    },
                    data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月']
                }],
                yAxis: [{
                    type: 'value',
                    max: '30',
                    axisTick: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#57617B'
                        }
                    },
                    axisLabel: {
                        margin: 10,
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#57617B'
                        }
                    }
                }],
                series: [
                    {
                        name: '预警次数',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 5,
                        showSymbol: false,  //所有的坐标点是都都显示
                        lineStyle: {
                            normal: {
                                width: 6   //最顶层线的宽度
                            }
                        },
                        areaStyle: {
                            normal: {
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                    offset: 0,  //从0到100%的样式，注意是上下覆盖
                                    color: 'rgba(79,107,245, 1)'
                                }, {
                                    offset: 1,    //如果是0.8下面有部分覆盖不了
                                    color: 'rgba(255,255,255, 0.3)'
                                }], false),
                                shadowColor: 'rgba(0, 0, 0, 0.1)',
                                shadowBlur: 10
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#4f6bf5',
                                borderColor: 'rgba(255,255,255,0.2)',
                                borderWidth: 12
                            }
                        },

                        data: [5, 25, 13, 15, 18, 14, 20, 25, 22, 27, 18, 28]
                    }
                ]
            }
            myChart_yj.setOption(option);
        })

        //企业实时预警信息
        function qyList(t) {

            layui.$.ajax({
                url: httpUrl + 'erps/real_time_warning',
                type: 'get',
                data: {
                    deptid: localStorage.getItem('deptid'),
                    city: router.search.city,
                    province: router.search.province
                },
                dataType: 'json',
                beforeSend: function () {
                    $('#lod').addClass('box')
                },
                success: function (data) {

                    $('#zx').text(data.code)
                    $('#zs').text('/' + data.count)
                    var d = data.data
                    if (d && d.length > 0) {
                        var opt = ''

                        for (var m = 0; m < d.length; m++) {
                            opt +=
                                '<li class="layui-card-body" style="cursor:pointer;" mn=' + d[m].mn + ' ' + 'name=' + d[m].ename + '>' +
                                '<div class="qymc">' +
                                '<div class="tipName"><img src="../images/img/sybs.png" alt=""><span>' + d[m].ename + '</span></div>' +
                                '<div class="tipon">' +
                                '<p>联网状态:<span>' + d[m].erponline + '</span></p>' +
                                '<p>阀门状态:<span>' + (d[m].valvestatus == 1 ? "开" : "关") + '</span></p>' +
                                '<p>检测仪表:<span><span>' + d[m].rtdsOnline + '</span>/<span>' + d[m].rtdsCount + '</span></span></p>' +
                                '<p>摄像头:<span><span>' + d[m].CameraonliCount + '</span>/<span>' + d[m].CameraCount + '</span></span></p>' +
                                '<p>今日排放量:<span class="num">' + d[m].hdsCount + '</span> (吨)</p>' +
                                '</div>' +
                                '<div class="tipbottom">' +
                                '<p>更新时间:<span>' + d[m].datatime + '</span></p>' +
                                '</div>' +
                                '</div>' +
                                '</li>'
                        }
                        $('.roll__list').html(opt)
                        if (t == '1') {
                            $('#d').rollSlide({
                                orientation: 'top',
                                num: 1,
                                v: 1500,
                                space: 1000,
                                isRoll: true
                            });
                        }

                    }
                },
                complete: function () {
                    $('#lod').removeClass('box')
                }
            })
        }
        qyList('1')

        //从企业实时预警信息跳转企业
        $(".roll__list").on("click", "li", function () {
            console.log($(this).attr('mn'))
            var mn = $(this).attr('mn')
            var name = $(this).attr('name')
            window.location.href = './city/' + (mn ? mn : "l000000") + '.html#/mn=' + mn + '/ename=' + name
        })
        //从阀门状态统计详情跳转企业
        $("#fmList").on("click", '.tz', function () {

            console.log($(this).attr('atr'))
            var mn = $(this).attr('atr')
            var name = $(this).attr('name')
            window.location.href = './city/' + (mn ? mn : "l000000") + '.html#/mn=' + mn + '/ename=' + name
        })
        //从阀门状态统计详情跳转企业
        $("#ui").on("click", '.tz', function () {

            console.log($(this).attr('atr'))
            var mn = $(this).attr('atr')
            var name = $(this).attr('name')
            window.location.href = './city/' + (mn ? mn : "l000000") + '.html#/mn=' + mn + '/ename=' + name
        })
        //刷新
        $('.sx').click(function () {

            $('.roll__list').html('')

            qyList('2')
        })
    });
</script>
</body>

</html>